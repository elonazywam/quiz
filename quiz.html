<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Wybierz Kategoriƒô</title>
    <style>
        /* CSS: Stylizowanie strony */
        body {
            font-family: Arial, sans-serif;
            /* statyczne, jednolite t≈Ço */
            background: #6C5CE7; /* mo≈ºesz zmieniƒá na dowolny hex/kolor nazwy */
            
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0; /* poprawka: usuniƒôte przypadkowe 'i' */
            color: #ecf0f1; 
            position: relative;
            /* Pozw√≥l na przewijanie na ma≈Çych ekranach */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* p≈Çynne przewijanie na iOS */
        }
        
        /* ≈Çagodne przyciemnienie nad t≈Çem, ale nie t≈ÇumiƒÖce koloru */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.30); /* lekkie przyciemnienie dla czytelno≈õci */
            z-index: 0;
            pointer-events: none;
        }

        .quiz-container {
            background-color: rgba(52, 73, 94, 0.9); /* P√ì≈ÅPRZEZROCZYSTE T≈ÅO DLA KONTENERA */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.9);
            width: 90%;
            max-width: 800px;
            /* Na ma≈Çych ekranach pozwalamy kontenerowi przewijaƒá zawarto≈õƒá */
            max-height: 95vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            text-align: center;
            z-index: 1;
            box-sizing: border-box;
            padding-bottom: calc(30px + env(safe-area-inset-bottom)); /* bezpieczny margines dolny na urzƒÖdzeniach z wyciƒôciem */
        }
        h1 {
            color: #f1c40f; 
            margin-bottom: 20px;
        }
        
        .logo {
            width: 150px; /* powiƒôkszone z 120px */
            height: 150px; /* powiƒôkszone z 120px */
            margin: 20px auto;
            object-fit: contain;
        }
        /* Ma≈Ça responsywna poprawka */
        @media (max-width: 420px) {
            .logo {
                width: 120px;
                height: 120px;
            }
        }
        
        /* ZMIANA UK≈ÅADU MENU */
        .main-nav {
            margin-bottom: 25px;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 10px;
            display: flex; 
            justify-content: center; 
        }
        .main-nav button {
            background: none;
            border: none;
            padding: 10px 15px;
            margin: 0 15px; 
            font-size: 16px;
            cursor: pointer;
            color: #bdc3c7; 
            transition: color 0.2s;
            text-transform: uppercase;
            font-weight: bold;
        }
        .main-nav button:hover {
            color: #ecf0f1;
            border-bottom: 2px solid #f1c40f; 
        }


        /* Sekcja Quizu i Opcje */
        .symbol-display {
            font-size: 80px;
            margin: 20px auto; 
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 10px;
            height: 100px; 
            display: flex;
            justify-content: center;
            align-items: center;
            color: #f1c40f; 
            width: 120px; 
        }
        .options button, .menu button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #2980b9; 
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .options button:hover, .menu button:hover {
            background-color: #3498db;
        }

        /* Styl dla sekcji "O nas" */
        #aboutContent {
            text-align: left;
            padding-top: 15px;
        }
        #aboutContent p {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        #aboutContent ul {
            list-style: disc;
            margin-left: 20px;
            padding-left: 0;
        }

        /* Style dla informacji zwrotnej i wyniku */
        .feedback {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            min-height: 25px; 
        }
        .correct { color: #2ecc71; } 
        .incorrect { color: #e74c3c; } 
        .score { margin-top: 15px; font-size: 16px; }
        #quizContent { display: none; }
        #aboutContent { display: none; }
        #opinionsContent { display: none; }

        /* Language selector (top-left) */
        .lang-selector {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 2;
            font-size: 14px;
            color: #ecf0f1;
            user-select: none;
        }
        .lang-btn {
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.08);
            color: #ecf0f1;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .lang-dropdown {
            display: none;
            margin-top: 6px;
            background: rgba(52,73,94,0.95);
            border-radius: 6px;
            padding: 6px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.6);
            min-width: 120px;
            text-align: left;
        }
        .lang-dropdown button {
            background: none;
            border: none;
            color: #ecf0f1;
            padding: 6px 8px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
        }
        .lang-dropdown button:hover {
            background: rgba(241,196,15,0.12);
            color: #f1c40f;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
</head>
<body>

    <div class="quiz-container">
        <!-- Language selector -->
        <div class="lang-selector" id="langSelector">
            <div class="lang-btn" id="langBtn">PL ‚ñæ</div>
            <div class="lang-dropdown" id="langDropdown">
                <button onclick="setLanguage('pl')">Polski</button>
                <button onclick="setLanguage('en')">English</button>
            </div>
        </div>

        <div class="main-nav">
            <button id="navStart" onclick="showSection('menu')">START</button>
            <button id="navAbout" onclick="showSection('about')">O PROJEKCIE</button>
            <button id="navOpinions" onclick="showSection('opinions')">OPINIE</button>
        </div>

        <h1 id="mainTitle">Wybierz Kategoriƒô Quizu</h1>
        
        <img id="logoImage" class="logo" src="logo.png" alt="Logo" style="display: none;">
        
        <div id="menu">
            </div>

        <div id="aboutContent">
            <!-- ...existing code... (will be replaced by JS translations on language change) -->
        </div>

        <div id="opinionsContent">
            <!-- ...existing code... (will be replaced by JS translations on language change) -->
        </div>

        <div id="quizContent">
            <p id="questionPrompt">Jaki symbol reprezentuje:</p>
            <div id="questionText" style="font-size: 24px; font-weight: bold; margin-bottom: 20px;"></div>
            
            <div id="symbolDisplay" class="symbol-display">?</div>

            <div id="options" class="options">
                </div>

            <div id="feedback" class="feedback"></div>

            <div id="score" class="score">Wynik: 0 / 0</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBnZ_your_api_key_here",
            authDomain: "quiz-opinions.firebaseapp.com",
            databaseURL: "https://quiz-opinions-default-rtdb.europe-west1.firebaseio.com",
            projectId: "quiz-opinions",
            storageBucket: "quiz-opinions.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123def456"
        };

        // Initialize Firebase
        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) {
            console.warn("Firebase not available, using localStorage fallback");
        }

        // --- BAZA PYTA≈É ---
        // Zachowujemy ma≈Çy zestaw dla poziomu "≈Åatwy"
        const allQuizData = {
            "Kraje (Flagi)": [
                { name: "Polska", symbol: "üáµüá±" },
                { name: "Niemcy", symbol: "üá©üá™" },
                { name: "W≈Çochy", symbol: "üáÆüáπ" },
                { name: "Hiszpania", symbol: "üá™üá∏" },
                { name: "Francja", symbol: "üá´üá∑" },
            ]
            // Usuniƒôto: "Zwierzƒôta (Emoji)" i "Jedzenie i Picie"
        };
        // Dodatkowa pe≈Çna pula flag z oznaczeniem regionu (u≈ºywana dla ≈öredni/Trudny)
        const allFlags = [
            { name: "Polska", symbol: "üáµüá±", region: "Europe", type: "country" },
            { name: "Niemcy", symbol: "üá©üá™", region: "Europe", type: "country" },
            { name: "W≈Çochy", symbol: "üáÆüáπ", region: "Europe", type: "country" },
            { name: "Hiszpania", symbol: "üá™üá∏", region: "Europe", type: "country" },
            { name: "Francja", symbol: "üá´üá∑", region: "Europe", type: "country" },
            { name: "Wielka Brytania", symbol: "üá¨üáß", region: "Europe", type: "country" },
            { name: "Szwecja", symbol: "üá∏üá™", region: "Europe", type: "country" },
            { name: "Norwegia", symbol: "üá≥üá¥", region: "Europe", type: "country" },
            { name: "Holandia", symbol: "üá≥üá±", region: "Europe", type: "country" },
            { name: "Portugalia", symbol: "üáµüáπ", region: "Europe", type: "country" },
            { name: "Stany Zjednoczone", symbol: "üá∫üá∏", region: "Americas", type: "country" },
            { name: "Kanada", symbol: "üá®üá¶", region: "Americas", type: "country" },
            { name: "Brazylia", symbol: "üáßüá∑", region: "Americas", type: "country" },
            { name: "Meksyk", symbol: "üá≤üáΩ", region: "Americas", type: "country" },
            { name: "Argentyna", symbol: "üá¶üá∑", region: "Americas", type: "country" },
            { name: "Japonia", symbol: "üáØüáµ", region: "Asia", type: "country" },
            { name: "Chiny", symbol: "üá®üá≥", region: "Asia", type: "country" },
            { name: "Indie", symbol: "üáÆüá≥", region: "Asia", type: "country" },
            { name: "Australia", symbol: "üá¶üá∫", region: "Oceania", type: "country" },
            { name: "Nowa Zelandia", symbol: "üá≥üáø", region: "Oceania", type: "country" },
            { name: "RPA", symbol: "üáøüá¶", region: "Africa", type: "country" },
            { name: "Egipt", symbol: "üá™üá¨", region: "Africa", type: "country" },
        ];
        const allFlagsExtended = allFlags.concat([
            { name: "Islandia", symbol: "üáÆüá∏", region: "Europe", type: "island" },
            { name: "Islandy (Faroe)", symbol: "üá´üá¥", region: "Europe", type: "island" },
            { name: "Malediwy", symbol: "üá≤üáª", region: "Asia", type: "island" },
            { name: "Fid≈ºi", symbol: "üá´üáØ", region: "Oceania", type: "island" },
            { name: "Bahamy", symbol: "üáßüá∏", region: "Americas", type: "island" },
            { name: "Bermudy", symbol: "üáßüá≤", region: "Americas", type: "island" },
            { name: "Seszele", symbol: "üá∏üá®", region: "Africa", type: "island" },
            { name: "Mauritius", symbol: "üá≤üá∫", region: "Africa", type: "island" },
            { name: "Kiribati", symbol: "üá∞üáÆ", region: "Oceania", type: "island" },
            { name: "Nauru", symbol: "üá≥üá∑", region: "Oceania", type: "island" },
            { name: "Palau", symbol: "üáµüáº", region: "Oceania", type: "island" },
            { name: "Wyspy Marshalla", symbol: "üá≤üá≠", region: "Oceania", type: "island" },
            { name: "Saint Kitts i Nevis", symbol: "üá∞üá≥", region: "Americas", type: "island" },
            { name: "Antigua i Barbuda", symbol: "üá¶üá¨", region: "Americas", type: "island" },
        ]);
        // ------------------

        let currentQuizData = []; 
        let currentPool = [];
        let currentQuestionIndex = 0;
        let score = 0;
        // ZAMIANA: zamiast dynamicznie inkrementowaƒá totalQuestions przy ka≈ºdym pytaniu,
        // ustawiamy docelowƒÖ liczbƒô pyta≈Ñ przy starcie quizu (max 10).
        let totalQuestions = 0;      // docelowa liczba pyta≈Ñ w tej sesji (np. 10)
        let answeredCount = 0;      // ile pyta≈Ñ ju≈º odpowiedziano (u≈ºywane do progresu)
        let incorrectAnswers = [];  // zbieramy obiekty { name, selected, correct }
        let lastCategory = null;
        let lastDifficulty = null;

        // Elementy DOM
        const menuContainer = document.getElementById('menu');
        const quizContent = document.getElementById('quizContent');
        const aboutContent = document.getElementById('aboutContent');
        const mainTitle = document.getElementById('mainTitle');
        const questionTextElement = document.getElementById('questionText');
        const symbolDisplayElement = document.getElementById('symbolDisplay');
        const optionsContainer = document.getElementById('options');
        const feedbackElement = document.getElementById('feedback');
        const scoreElement = document.getElementById('score');

        // --- G≈Å√ìWNA FUNKCJA ZARZƒÑDZANIA WIDOKAMI ---
        function showSection(sectionId) {
            // Ukrywa wszystkie sekcje
            menuContainer.style.display = 'none';
            quizContent.style.display = 'none';
            aboutContent.style.display = 'none';
            document.getElementById('opinionsContent').style.display = 'none';
            
            // Pokazuje tylko wybranƒÖ sekcjƒô
            if (sectionId === 'menu') {
                showMenu();
                menuContainer.style.display = 'block';
            } else if (sectionId === 'about') {
                mainTitle.textContent = "Informacje o projekcie";
                aboutContent.style.display = 'block';
            } else if (sectionId === 'opinions') {
                mainTitle.textContent = "Opinie u≈ºytkownik√≥w";
                document.getElementById('opinionsContent').style.display = 'block';
                loadOpinions();
            }
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- FUNKCJA WYSWIETLA MENU ---
        function showMenu() {
            document.getElementById('logoImage').style.display = 'block';
            menuContainer.innerHTML = '';
            mainTitle.textContent = i18n[currentLanguage].mainTitle;

            Object.keys(allQuizData).forEach(categoryName => {
                const button = document.createElement('button');
                button.textContent = i18n[currentLanguage].categoryMap[categoryName] || categoryName;
                button.onclick = () => showDifficulty(categoryName);
                menuContainer.appendChild(button);
            });
        }

        function showDifficulty(categoryName) {
            mainTitle.textContent = i18n[currentLanguage].difficultyTitle;
            lastCategory = categoryName; // save internal category key
            menuContainer.innerHTML = '';

            // difficulty keys (internal) mapped to labels
            const keys = ['easy','medium','hard','very'];
            keys.forEach(key => {
                const btn = document.createElement('button');
                btn.textContent = i18n[currentLanguage].difficulties[key];
                btn.onclick = () => startQuiz(categoryName, key);
                menuContainer.appendChild(btn);
            });
        }

        function startQuiz(categoryName, difficultyKey) {
            lastCategory = categoryName;
            lastDifficulty = difficultyKey; // save internal key
            // Wyb√≥r puli pyta≈Ñ zale≈ºnie od kategorii i poziomu trudno≈õci (u≈ºywamy kluczy)
            if (categoryName === "Kraje (Flagi)") {
                if (difficultyKey === 'very') {
                    currentPool = allFlagsExtended.filter(item => item.type === "island");
                } else if (difficultyKey === 'hard') {
                    currentPool = allFlags.slice();
                } else if (difficultyKey === 'medium') {
                    currentPool = allFlags.filter(f => f.region === 'Europe');
                } else {
                    currentPool = allQuizData["Kraje (Flagi)"].slice();
                }
                currentQuizData = currentPool.map(item => ({ name: item.name, symbol: item.symbol, type: item.type }));
            }
            shuffleArray(currentQuizData);
            currentQuestionIndex = 0;
            score = 0;
            totalQuestions = Math.min(10, currentQuizData.length);
            answeredCount = 0;
            incorrectAnswers = [];

            mainTitle.textContent = `${i18n[currentLanguage].categoryMap[categoryName] || categoryName} - Poziom: ${i18n[currentLanguage].difficulties[difficultyKey]}`;
            document.getElementById('logoImage').style.display = 'none';
            menuContainer.style.display = 'none';
            aboutContent.style.display = 'none';
            quizContent.style.display = 'block';
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                questionTextElement.textContent = i18n[currentLanguage].mainTitle; // or "Koniec Quizu!"
                symbolDisplayElement.textContent = "üéâ";
                let wrongCount = totalQuestions - score;
                let summaryHtml = `<div style="text-align:left;">
                    <p>Twoje wyniki: <strong>${score}</strong> poprawnych, <strong>${wrongCount}</strong> b≈Çƒôdnych (z ${totalQuestions}).</p>`;

                // Zbuduj pe≈ÇnƒÖ listƒô odpowiedzi u≈ºytkownika (poprawne i b≈Çƒôdne)
                let allAnswers = [];
                for (let i = 0; i < totalQuestions; i++) {
                    const q = currentQuizData[i];
                    // Szukamy czy by≈Ça b≈Çƒôdna odpowied≈∫ dla tego pytania
                    const wrong = incorrectAnswers.find(item => item.name === q.name);
                    if (wrong) {
                        allAnswers.push({
                            name: q.name,
                            selected: wrong.selected,
                            correct: q.symbol,
                            isCorrect: false
                        });
                    } else {
                        allAnswers.push({
                            name: q.name,
                            selected: q.symbol,
                            correct: q.symbol,
                            isCorrect: true
                        });
                    }
                }

                summaryHtml += `<table style="width:100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Pytanie</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Twoja odpowied≈∫</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Poprawna odpowied≈∫</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Status</th>
                        </tr>
                    </thead>
                    <tbody>`;
                allAnswers.forEach(item => {
                    summaryHtml += `<tr>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.name}</td>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.selected}</td>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.correct}</td>
                        <td style="padding:6px; border-top:1px solid #eee; color:${item.isCorrect ? '#2ecc71' : '#e74c3c'};">
                            ${item.isCorrect ? '‚úîÔ∏è' : '‚ùå'}
                        </td>
                    </tr>`;
                });
                summaryHtml += `</tbody></table>`;

                summaryHtml += `<div style="margin-top:12px;">
                    <button onclick="showSection('menu')" style="margin-right:8px;">${i18n[currentLanguage].summaryBackToMenu}</button>
                    <button onclick="startQuiz('${lastCategory}', '${lastDifficulty}')">${i18n[currentLanguage].summaryTryAgain}</button>
                </div>
                </div>`;

                optionsContainer.innerHTML = summaryHtml;
                feedbackElement.textContent = "";
                scoreElement.textContent = `Wynik: ${score} / ${totalQuestions}`;
                return;
            }

            const currentQuestion = currentQuizData[currentQuestionIndex];
            questionTextElement.textContent = currentQuestion.name;
            symbolDisplayElement.textContent = "?";
            optionsContainer.innerHTML = '';
            feedbackElement.textContent = '';

            let options = [currentQuestion.symbol];
            let incorrectSymbols = [];
            const questionType = currentQuestion.type;

            currentPool.forEach(item => {
                if (item.symbol && item.symbol !== currentQuestion.symbol) {
                    if (!questionType || item.type === questionType) {
                        incorrectSymbols.push(item.symbol);
                    }
                }
            });
            shuffleArray(incorrectSymbols);
            options = options.concat(incorrectSymbols.slice(0, Math.min(3, incorrectSymbols.length)));
            shuffleArray(options);

            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkAnswer(button, option, currentQuestion.symbol, currentQuestion.name);
                optionsContainer.appendChild(button);
            });

            scoreElement.textContent = `Ilo≈õƒá: ${currentQuestionIndex + 1} / ${totalQuestions}`;
        }
        
        function checkAnswer(clickedButton, selectedSymbol, correctAnswerSymbol, questionName) {
            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
            });
            symbolDisplayElement.textContent = correctAnswerSymbol;

            if (selectedSymbol === correctAnswerSymbol) {
                feedbackElement.textContent = i18n[currentLanguage].feedback.correct;
                feedbackElement.className = "feedback correct";
                clickedButton.style.backgroundColor = "#2ecc71";
                score++;
            } else {
                feedbackElement.textContent = i18n[currentLanguage].feedback.incorrectPrefix + correctAnswerSymbol;
                feedbackElement.className = "feedback incorrect";
                clickedButton.style.backgroundColor = "#e74c3c";
                Array.from(optionsContainer.children).forEach(button => {
                    if (button.textContent === correctAnswerSymbol) {
                        button.style.backgroundColor = "#2ecc71";
                    }
                });
                incorrectAnswers.push({
                    name: questionName,
                    selected: selectedSymbol,
                    correct: correctAnswerSymbol
                });
            }

            answeredCount++;
            if (currentQuestionIndex + 1 < totalQuestions) {
                scoreElement.textContent = `Ilo≈õƒá: ${currentQuestionIndex + 2} / ${totalQuestions}`;
            }

            setTimeout(() => {
                currentQuestionIndex++;
                loadQuestion();
            }, 1200);
        }

        // --- OPINIE (ZAKTUALIZOWANE NA FIREBASE) ---

        function loadOpinions() {
            const opinionsList = document.getElementById('opinionsList');
            
            if (!db) {
                // Fallback na localStorage
                const opinions = JSON.parse(localStorage.getItem('quizOpinions')) || [];
                displayOpinions(opinions, opinionsList);
                return;
            }

            // ≈Åadowanie z Firebase
            opinionsList.innerHTML = `<p style="text-align: center; color: #bdc3c7;">${i18n[currentLanguage].loadingOpinions}</p>`;
            
            const opinionsRef = firebase.database().ref('opinions');
            opinionsRef.orderByChild('timestamp').limitToLast(50).once('value', (snapshot) => {
                const data = snapshot.val();
                const opinions = data ? Object.values(data) : [];
                displayOpinions(opinions.reverse(), opinionsList);
            }).catch(error => {
                console.error("Firebase error:", error);
                opinionsList.innerHTML = `<p style="text-align: center; color: #e74c3c;">B≈ÇƒÖd ≈Çadowania opinii</p>`;
            });
        }

        function displayOpinions(opinions, opinionsList) {
            if (opinions.length === 0) {
                opinionsList.innerHTML = `<p style="text-align: center; color: #bdc3c7;">${i18n[currentLanguage].noOpinions}</p>`;
                return;
            }
            opinionsList.innerHTML = '';
            opinions.forEach((opinion) => {
                const opinionDiv = document.createElement('div');
                opinionDiv.style.cssText = 'background-color: rgba(100, 100, 100, 0.2); padding: 12px; margin: 10px 0; border-radius: 6px; border-left: 3px solid #f1c40f;';
                const dateStr = opinion.date || 'Niedawno';
                opinionDiv.innerHTML = `
                    <p style="margin: 0 0 5px 0; font-weight: bold; color: #f1c40f;">${opinion.author || 'Anonimowy'}</p>
                    <p style="margin: 0; color: #ecf0f1;">${opinion.text}</p>
                    <small style="color: #bdc3c7;">${dateStr}</small>
                `;
                opinionsList.appendChild(opinionDiv);
            });
        }

        function addOpinion() {
            const author = document.getElementById('opinionAuthor').value.trim();
            const text = document.getElementById('opinionText').value.trim();

            if (text === '') {
                alert(i18n[currentLanguage].alertEmptyOpinion);
                return;
            }

            const now = new Date();
            const dateStr = now.toLocaleDateString((currentLanguage==='pl')?'pl-PL':'en-GB') + ' ' + now.toLocaleTimeString((currentLanguage==='pl')?'pl-PL':'en-GB', { hour: '2-digit', minute: '2-digit' });

            if (!db) {
                // Fallback na localStorage
                const opinions = JSON.parse(localStorage.getItem('quizOpinions')) || [];
                opinions.push({
                    author: author || (currentLanguage==='pl' ? 'Anonimowy' : 'Anonymous'),
                    text: text,
                    date: dateStr
                });
                localStorage.setItem('quizOpinions', JSON.stringify(opinions));
                loadOpinions();
                alert(i18n[currentLanguage].alertThankYou);
                return;
            }

            // Zapis do Firebase
            const opinionsRef = firebase.database().ref('opinions').push();
            opinionsRef.set({
                author: author || (currentLanguage==='pl' ? 'Anonimowy' : 'Anonymous'),
                text: text,
                date: dateStr,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById('opinionAuthor').value = '';
                document.getElementById('opinionText').value = '';
                loadOpinions();
                alert(i18n[currentLanguage].alertThankYou);
            }).catch(error => {
                console.error("Error:", error);
                alert(i18n[currentLanguage].alertOpinionError);
            });
        }

        // Toggle dropdown
        document.getElementById('langBtn').addEventListener('click', () => {
            const dd = document.getElementById('langDropdown');
            dd.style.display = dd.style.display === 'block' ? 'none' : 'block';
        });
        // Close dropdown on outside click
        window.addEventListener('click', (e) => {
            const ls = document.getElementById('langSelector');
            if (!ls.contains(e.target)) {
                document.getElementById('langDropdown').style.display = 'none';
            }
        });

        // Dodajemy obiekt t≈Çumacze≈Ñ
        const i18n = {
            pl: {
                nav: { start: "START", about: "O PROJEKCIE", opinions: "OPINIE" },
                mainTitle: "Wybierz Kategoriƒô Quizu",
                difficultyTitle: "Wybierz poziom trudno≈õci",
                categoryMap: {
                    "Kraje (Flagi)": "Kraje (Flagi)"
                },
                difficulties: {
                    easy: "≈Åatwy",
                    medium: "≈öredni",
                    hard: "Trudny",
                    very: "Bardzo trudny"
                },
                questionPrompt: "Jaki symbol reprezentuje:",
                feedback: {
                    correct: "Poprawna odpowied≈∫!",
                    incorrectPrefix: "B≈Çƒôdnie. Poprawny symbol: "
                },
                summaryBackToMenu: "Powr√≥t do menu",
                summaryTryAgain: "Zagraj ponownie",
                loadingOpinions: "≈Åadowanie opinii...",
                noOpinions: "Brak opinii. BƒÖd≈∫ pierwszy!",
                alertEmptyOpinion: "Proszƒô napisaƒá swojƒÖ opiniƒô przed wys≈Çaniem.",
                alertThankYou: "Dziƒôkujemy za opiniƒô!",
                alertOpinionError: "WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisywania opinii.",
                aboutHTML: `
                    <h2>O projekcie</h2>
                    <p>Prosty quiz edukacyjny uczƒÖcy rozpoznawania flag kraj√≥w. Aplikacja obs≈Çuguje wiele poziom√≥w trudno≈õci i zapis opinii u≈ºytkownik√≥w.</p>
                    <p>Wersja jƒôzykowa dostƒôpna w polskim i angielskim.</p>
                `,
                opinionsForm: {
                    header: "Opinie u≈ºytkownik√≥w",
                    shareHeading: "Podziel siƒô swojƒÖ opiniƒÖ",
                    authorPlaceholder: "Twoje imiƒô (opcjonalnie)",
                    textPlaceholder: "Napisz opiniƒô...",
                    sendButton: "Wy≈õlij opiniƒô"
                }
            },
            en: {
                nav: { start: "START", about: "ABOUT", opinions: "OPINIONS" },
                mainTitle: "Choose Quiz Category",
                difficultyTitle: "Choose difficulty level",
                categoryMap: {
                    "Kraje (Flagi)": "Countries (Flags)"
                },
                difficulties: {
                    easy: "Easy",
                    medium: "Medium",
                    hard: "Hard",
                    very: "Very Hard"
                },
                questionPrompt: "Which symbol represents:",
                feedback: {
                    correct: "Correct answer!",
                    incorrectPrefix: "Incorrect. Correct symbol: "
                },
                summaryBackToMenu: "Back to menu",
                summaryTryAgain: "Try again",
                loadingOpinions: "Loading opinions...",
                noOpinions: "No opinions yet. Be the first!",
                alertEmptyOpinion: "Please write your opinion before sending.",
                alertThankYou: "Thanks for your opinion!",
                alertOpinionError: "Error while saving your opinion.",
                aboutHTML: `
                    <h2>About this project</h2>
                    <p>A simple educational quiz for recognizing country flags. Supports multiple difficulty levels and user opinions.</p>
                    <p>Language versions available: Polish and English.</p>
                `,
                opinionsForm: {
                    header: "User opinions",
                    shareHeading: "Share your opinion",
                    authorPlaceholder: "Your name (optional)",
                    textPlaceholder: "Write your opinion...",
                    sendButton: "Send opinion"
                }
            }
        };

        let currentLanguage = 'pl';

        function setLanguage(lang) {
            currentLanguage = lang;
            const t = i18n[lang];

            // Update nav buttons
            document.getElementById('navStart').textContent = t.nav.start;
            document.getElementById('navAbout').textContent = t.nav.about;
            document.getElementById('navOpinions').textContent = t.nav.opinions;
            document.getElementById('langBtn').textContent = (lang === 'pl') ? 'PL ‚ñæ' : 'EN ‚ñæ';

            // Update mainTitle if on menu, otherwise keep context-aware changes
            if (document.getElementById('menu').style.display !== 'none') {
                document.getElementById('mainTitle').textContent = t.mainTitle;
            }

            // Update static content: about & opinions (rebuild so IDs remain)
            document.getElementById('aboutContent').innerHTML = t.aboutHTML;

            // opinionsContent: build form + opinionsList container
            document.getElementById('opinionsContent').innerHTML = `
                <h2>${t.opinionsForm.header}</h2>
                <div style="background-color: rgba(100, 100, 100, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>${t.opinionsForm.shareHeading}</h3>
                    <input type="text" id="opinionAuthor" placeholder="${t.opinionsForm.authorPlaceholder}" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 4px; box-sizing: border-box;">
                    <textarea id="opinionText" placeholder="${t.opinionsForm.textPlaceholder}" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 4px; box-sizing: border-box; min-height: 80px; font-family: Arial, sans-serif;"></textarea>
                    <button onclick="addOpinion()" style="width: 100%; padding: 10px; background-color: #f1c40f; color: #2c3e50; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 16px;">${t.opinionsForm.sendButton}</button>
                </div>
                <div id="opinionsList" style="max-height: 400px; overflow-y: auto;"></div>
            `;

            // Update question prompt
            const qp = document.getElementById('questionPrompt');
            if (qp) qp.textContent = t.questionPrompt;

            // If currently showing difficulty menu, regenerate it in selected language
            if (document.getElementById('menu').style.display !== 'none' && mainTitle.textContent === i18n[lang].difficultyTitle) {
                // Recreate difficulty view for current category if available
                // store current category from lastCategory if set
                if (lastCategory) showDifficulty(lastCategory);
            }
        }

        // Uruchomienie menu przy ≈Çadowaniu strony i ustawienie domy≈õlnego jƒôzyka
        window.onload = () => {
            showSection('menu');
            setLanguage('pl');
        };
    </script>

</body>
</html>
