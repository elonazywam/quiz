<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Wybierz Kategoriƒô</title>
    <style>
        /* CSS: Stylizowanie strony */
        body {
            font-family: Arial, sans-serif;
            /* statyczne, jednolite t≈Ço */
            background: #6C5CE7; /* mo≈ºesz zmieniƒá na dowolny hex/kolor nazwy */
            
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0; /* poprawka: usuniƒôte przypadkowe 'i' */
            color: #ecf0f1; 
            position: relative;
            /* Pozw√≥l na przewijanie na ma≈Çych ekranach */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* p≈Çynne przewijanie na iOS */
        }
        
        /* ≈Çagodne przyciemnienie nad t≈Çem, ale nie t≈ÇumiƒÖce koloru */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.30); /* lekkie przyciemnienie dla czytelno≈õci */
            z-index: 0;
            pointer-events: none;
        }

        .quiz-container {
            background-color: rgba(52, 73, 94, 0.9); /* P√ì≈ÅPRZEZROCZYSTE T≈ÅO DLA KONTENERA */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.9);
            width: 90%;
            max-width: 800px;
            /* Na ma≈Çych ekranach pozwalamy kontenerowi przewijaƒá zawarto≈õƒá */
            max-height: 95vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            text-align: center;
            z-index: 1;
            box-sizing: border-box;
            padding-bottom: calc(30px + env(safe-area-inset-bottom)); /* bezpieczny margines dolny na urzƒÖdzeniach z wyciƒôciem */
        }
        h1 {
            color: #f1c40f; 
            margin-bottom: 20px;
        }
        
        .logo {
            width: 150px; /* powiƒôkszone z 120px */
            height: 150px; /* powiƒôkszone z 120px */
            margin: 20px auto;
            object-fit: contain;
        }
        /* Ma≈Ça responsywna poprawka */
        @media (max-width: 420px) {
            .logo {
                width: 120px;
                height: 120px;
            }
        }
        
        /* ZMIANA UK≈ÅADU MENU */
        .main-nav {
            margin-bottom: 25px;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 10px;
            display: flex; 
            justify-content: center; 
        }
        .main-nav button {
            background: none;
            border: none;
            padding: 10px 15px;
            margin: 0 15px; 
            font-size: 16px;
            cursor: pointer;
            color: #bdc3c7; 
            transition: color 0.2s;
            text-transform: uppercase;
            font-weight: bold;
        }
        .main-nav button:hover {
            color: #ecf0f1;
            border-bottom: 2px solid #f1c40f; 
        }


        /* Sekcja Quizu i Opcje */
        .symbol-display {
            font-size: 80px;
            margin: 20px auto; 
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 10px;
            height: 100px; 
            display: flex;
            justify-content: center;
            align-items: center;
            color: #f1c40f; 
            width: 120px; 
        }
        .options button, .menu button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #2980b9; 
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .options button:hover, .menu button:hover {
            background-color: #3498db;
        }

        /* Styl dla sekcji "O nas" */
        #aboutContent {
            text-align: left;
            padding-top: 15px;
        }
        #aboutContent p {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        #aboutContent ul {
            list-style: disc;
            margin-left: 20px;
            padding-left: 0;
        }

        /* Style dla informacji zwrotnej i wyniku */
        .feedback {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            min-height: 25px; 
        }
        .correct { color: #2ecc71; } 
        .incorrect { color: #e74c3c; } 
        .score { margin-top: 15px; font-size: 16px; }
        #quizContent { display: none; }
        #aboutContent { display: none; }
        #opinionsContent { display: none; }

        /* Language selector (top-left) */
        .lang-selector {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 2;
            font-size: 14px;
            color: #ecf0f1;
            user-select: none;
        }
        .lang-btn {
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.08);
            color: #ecf0f1;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .lang-dropdown {
            display: none;
            margin-top: 6px;
            background: rgba(52,73,94,0.95);
            border-radius: 6px;
            padding: 6px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.6);
            min-width: 120px;
            text-align: left;
        }
        .lang-dropdown button {
            background: none;
            border: none;
            color: #ecf0f1;
            padding: 6px 8px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
        }
        .lang-dropdown button:hover {
            background: rgba(241,196,15,0.12);
            color: #f1c40f;
        }

        /* Styl dla przycisk√≥w w g≈Ç√≥wnym menu (#menu) - identyczny wyglƒÖd jak opcje quizu */
        #menu button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #2980b9;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-transform: uppercase;
            font-weight: bold;
            box-sizing: border-box;
        }
        #menu button:hover {
            background-color: #3498db;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
    <!-- T≈Çumaczenia -->
    <script src="i18n.js"></script>
</head>
<body>

    <div class="quiz-container">
        <!-- Language selector -->
        <div class="lang-selector" id="langSelector">
            <div class="lang-btn" id="langBtn">PL ‚ñæ</div>
            <div class="lang-dropdown" id="langDropdown">
                <button onclick="setLanguage('pl')">Polski</button>
                <button onclick="setLanguage('en')">English</button>
            </div>
        </div>

        <div class="main-nav">
            <button id="navStart" onclick="showSection('menu')">START</button>
            <button id="navAbout" onclick="showSection('about')">O PROJEKCIE</button>
            <button id="navOpinions" onclick="showSection('opinions')">OPINIE</button>
        </div>

        <h1 id="mainTitle">Wybierz Kategoriƒô Quizu</h1>
        
        <img id="logoImage" class="logo" src="logo.png" alt="Logo" style="display: none;">
        
        <div id="menu">
            </div>

        <div id="aboutContent">
            <!-- ...existing code... (will be replaced by JS translations on language change) -->
        </div>

        <div id="opinionsContent">
            <!-- ...existing code... (will be replaced by JS translations on language change) -->
        </div>

        <div id="quizContent">
            <p id="questionPrompt">Jaki symbol reprezentuje:</p>
            <div id="questionText" style="font-size: 24px; font-weight: bold; margin-bottom: 20px;"></div>
            
            <div id="symbolDisplay" class="symbol-display">?</div>

            <div id="options" class="options">
                </div>

            <div id="feedback" class="feedback"></div>

            <div id="score" class="score">Wynik: 0 / 0</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBnZ_your_api_key_here",
            authDomain: "quiz-opinions.firebaseapp.com",
            databaseURL: "https://quiz-opinions-default-rtdb.europe-west1.firebaseio.com",
            projectId: "quiz-opinions",
            storageBucket: "quiz-opinions.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123def456"
        };

        // Initialize Firebase
        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) {
            console.warn("Firebase not available, using localStorage fallback");
        }

        // --- BAZA PYTA≈É ---
        const allQuizData = {
            "Kraje (Flagi)": [
                { name: "Polska", symbol: "üáµüá±" },
                { name: "Niemcy", symbol: "üá©üá™" },
                { name: "W≈Çochy", symbol: "üáÆüáπ" },
                { name: "Hiszpania", symbol: "üá™üá∏" },
                { name: "Francja", symbol: "üá´üá∑" },
            ]
        };

        const allFlags = [
            // EUROPA
            { name: "Polska", symbol: "üáµüá±", region: "Europe", type: "country" },
            { name: "Niemcy", symbol: "üá©üá™", region: "Europe", type: "country" },
            { name: "W≈Çochy", symbol: "üáÆüáπ", region: "Europe", type: "country" },
            { name: "Hiszpania", symbol: "üá™üá∏", region: "Europe", type: "country" },
            { name: "Francja", symbol: "üá´üá∑", region: "Europe", type: "country" },
            { name: "Wielka Brytania", symbol: "üá¨üáß", region: "Europe", type: "country" },
            { name: "Szwecja", symbol: "üá∏üá™", region: "Europe", type: "country" },
            { name: "Norwegia", symbol: "üá≥üá¥", region: "Europe", type: "country" },
            { name: "Holandia", symbol: "üá≥üá±", region: "Europe", type: "country" },
            { name: "Portugalia", symbol: "üáµüáπ", region: "Europe", type: "country" },
            { name: "Belgia", symbol: "üáßüá™", region: "Europe", type: "country" },
            { name: "Szwajcaria", symbol: "üá®üá≠", region: "Europe", type: "country" },
            { name: "Austria", symbol: "üá¶üáπ", region: "Europe", type: "country" },
            { name: "Grecja", symbol: "üá¨üá∑", region: "Europe", type: "country" },
            { name: "Czechy", symbol: "üá®üáø", region: "Europe", type: "country" },
            { name: "S≈Çowacja", symbol: "üá∏üá∞", region: "Europe", type: "country" },
            { name: "Wƒôgry", symbol: "üá≠üá∫", region: "Europe", type: "country" },
            { name: "Rumunia", symbol: "üá∑üá¥", region: "Europe", type: "country" },
            { name: "Bu≈Çgaria", symbol: "üáßüá¨", region: "Europe", type: "country" },
            { name: "Serbia", symbol: "üá∑üá∏", region: "Europe", type: "country" },
            { name: "Chorwacja", symbol: "üá≠üá∑", region: "Europe", type: "country" },
            { name: "S≈Çowenia", symbol: "üá∏üáÆ", region: "Europe", type: "country" },
            { name: "Bo≈õnia i Hercegowina", symbol: "üáßüá¶", region: "Europe", type: "country" },
            { name: "Monako", symbol: "üá≤üá®", region: "Europe", type: "country" },
            { name: "Liechtenstein", symbol: "üá±üáÆ", region: "Europe", type: "country" },
            { name: "Luksemburg", symbol: "üá±üá∫", region: "Europe", type: "country" },
            { name: "Dania", symbol: "üá©üá∞", region: "Europe", type: "country" },
            { name: "Finlandia", symbol: "üá´üáÆ", region: "Europe", type: "country" },
            { name: "Rosja", symbol: "üá∑üá∫", region: "Europe", type: "country" },
            { name: "Ukraina", symbol: "üá∫üá¶", region: "Europe", type: "country" },
            { name: "Bia≈Çoru≈õ", symbol: "üáßüáæ", region: "Europe", type: "country" },
            { name: "Mo≈Çdawia", symbol: "üá≤üá©", region: "Europe", type: "country" },
            { name: "Litwa", symbol: "üá±üáπ", region: "Europe", type: "country" },
            { name: "≈Åotwa", symbol: "üá±üáª", region: "Europe", type: "country" },
            { name: "Estonia", symbol: "üá™üá™", region: "Europe", type: "country" },
            { name: "Albania", symbol: "üá¶üá±", region: "Europe", type: "country" },
            { name: "Kosowo", symbol: "üáΩüá∞", region: "Europe", type: "country" },
            { name: "Macedonia", symbol: "üá≤üá∞", region: "Europe", type: "country" },
            { name: "Cypr", symbol: "üá®üáæ", region: "Europe", type: "country" },
            { name: "Malta", symbol: "üá≤üáπ", region: "Europe", type: "country" },
            { name: "Islandia", symbol: "üáÆüá∏", region: "Europe", type: "country" },
            { name: "Irlandia", symbol: "üáÆüá™", region: "Europe", type: "country" },
            { name: "San Marino", symbol: "üá∏üá≤", region: "Europe", type: "country" },
            { name: "Watykan", symbol: "üáªüá¶", region: "Europe", type: "country" },
            // AZJA
            { name: "Japonia", symbol: "üáØüáµ", region: "Asia", type: "country" },
            { name: "Chiny", symbol: "üá®üá≥", region: "Asia", type: "country" },
            { name: "Indie", symbol: "üáÆüá≥", region: "Asia", type: "country" },
            { name: "Korea Po≈Çudniowa", symbol: "üá∞üá∑", region: "Asia", type: "country" },
            { name: "Korea P√≥≈Çnocna", symbol: "üá∞üáµ", region: "Asia", type: "country" },
            { name: "Tajlandia", symbol: "üáπüá≠", region: "Asia", type: "country" },
            { name: "Wietnam", symbol: "üáªüá≥", region: "Asia", type: "country" },
            { name: "Kambod≈ºa", symbol: "üá∞üá≠", region: "Asia", type: "country" },
            { name: "Laos", symbol: "üá±üá¶", region: "Asia", type: "country" },
            { name: "Myanmar", symbol: "üá≤üá≤", region: "Asia", type: "country" },
            { name: "Malezja", symbol: "üá≤üáæ", region: "Asia", type: "country" },
            { name: "Singapur", symbol: "üá∏üá¨", region: "Asia", type: "country" },
            { name: "Indonezja", symbol: "üáÆüá©", region: "Asia", type: "country" },
            { name: "Filipiny", symbol: "üáµüá≠", region: "Asia", type: "country" },
            { name: "Bangladesz", symbol: "üáßüá©", region: "Asia", type: "country" },
            { name: "Pakistan", symbol: "üáµüá∞", region: "Asia", type: "country" },
            { name: "Afganistan", symbol: "üá¶üá´", region: "Asia", type: "country" },
            { name: "Iran", symbol: "üáÆüá∑", region: "Asia", type: "country" },
            { name: "Irak", symbol: "üáÆüá∂", region: "Asia", type: "country" },
            { name: "Syria", symbol: "üá∏üáæ", region: "Asia", type: "country" },
            { name: "Liban", symbol: "üá±üáß", region: "Asia", type: "country" },
            { name: "Izrael", symbol: "üáÆüá±", region: "Asia", type: "country" },
            { name: "Palestyna", symbol: "üáµüá∏", region: "Asia", type: "country" },
            { name: "Jordania", symbol: "üáØüá¥", region: "Asia", type: "country" },
            { name: "Arabia Saudyjska", symbol: "üá∏üá¶", region: "Asia", type: "country" },
            { name: "Jemen", symbol: "üáæüá™", region: "Asia", type: "country" },
            { name: "Oman", symbol: "üá¥üá≤", region: "Asia", type: "country" },
            { name: "ZEA", symbol: "üá¶üá™", region: "Asia", type: "country" },
            { name: "Katar", symbol: "üá∂üá¶", region: "Asia", type: "country" },
            { name: "Bahrajn", symbol: "üáßüá≠", region: "Asia", type: "country" },
            { name: "Kuwejt", symbol: "üá∞üáº", region: "Asia", type: "country" },
            { name: "Turcja", symbol: "üáπüá∑", region: "Asia", type: "country" },
            { name: "Kazachstan", symbol: "üá∞üáø", region: "Asia", type: "country" },
            { name: "Uzbekistan", symbol: "üá∫üáø", region: "Asia", type: "country" },
            { name: "Turkmenistan", symbol: "üáπüá≤", region: "Asia", type: "country" },
            { name: "Kirgistan", symbol: "üá∞üá¨", region: "Asia", type: "country" },
            { name: "Tad≈ºykistan", symbol: "üáπüáØ", region: "Asia", type: "country" },
            { name: "Mongolia", symbol: "üá≤üá≥", region: "Asia", type: "country" },
            { name: "Nepal", symbol: "üá≥üáµ", region: "Asia", type: "country" },
            { name: "Bhutan", symbol: "üáßüáπ", region: "Asia", type: "country" },
            { name: "Sri Lanka", symbol: "üá±üá∞", region: "Asia", type: "country" },
            { name: "Tajwan", symbol: "üáπüáº", region: "Asia", type: "country" },
            { name: "Brunei", symbol: "üáßüá≥", region: "Asia", type: "country" },
            { name: "Timor Wschodni", symbol: "üáπüá±", region: "Asia", type: "country" },
            { name: "Hong Kong", symbol: "üá≠üá∞", region: "Asia", type: "country" },
            // AFRYKA
            { name: "Egipt", symbol: "üá™üá¨", region: "Africa", type: "country" },
            { name: "Libia", symbol: "üá±üáæ", region: "Africa", type: "country" },
            { name: "Tunezja", symbol: "üáπüá≥", region: "Africa", type: "country" },
            { name: "Algieria", symbol: "üá©üáø", region: "Africa", type: "country" },
            { name: "Maroko", symbol: "üá≤üá¶", region: "Africa", type: "country" },
            { name: "Sudan", symbol: "üá∏üá©", region: "Africa", type: "country" },
            { name: "Sudan Po≈Çudniowy", symbol: "üá∏üá∏", region: "Africa", type: "country" },
            { name: "Etiopia", symbol: "üá™üáπ", region: "Africa", type: "country" },
            { name: "Eritrea", symbol: "üá™üá∑", region: "Africa", type: "country" },
            { name: "D≈ºibuti", symbol: "üá©üáØ", region: "Africa", type: "country" },
            { name: "Somalia", symbol: "üá∏üá¥", region: "Africa", type: "country" },
            { name: "Kenia", symbol: "üá∞üá™", region: "Africa", type: "country" },
            { name: "Uganda", symbol: "üá∫üá¨", region: "Africa", type: "country" },
            { name: "Tanzania", symbol: "üáπüáø", region: "Africa", type: "country" },
            { name: "Rwanda", symbol: "üá∑üáº", region: "Africa", type: "country" },
            { name: "Burundi", symbol: "üáßüáÆ", region: "Africa", type: "country" },
            { name: "DRK", symbol: "üá®üá©", region: "Africa", type: "country" },
            { name: "Kongo", symbol: "üá®üá¨", region: "Africa", type: "country" },
            { name: "Gabon", symbol: "üá¨üá¶", region: "Africa", type: "country" },
            { name: "Kamerun", symbol: "üá®üá≤", region: "Africa", type: "country" },
            { name: "Czad", symbol: "üáπüá©", region: "Africa", type: "country" },
            { name: "Republika ≈örodkowoafryka≈Ñska", symbol: "üá®üá´", region: "Africa", type: "country" },
            { name: "Mauritania", symbol: "üá≤üá∑", region: "Africa", type: "country" },
            { name: "Senegal", symbol: "üá∏üá≥", region: "Africa", type: "country" },
            { name: "Gambia", symbol: "üá¨üá≤", region: "Africa", type: "country" },
            { name: "Gwinea Bissau", symbol: "üá¨üáº", region: "Africa", type: "country" },
            { name: "Gwinea", symbol: "üá¨üá≥", region: "Africa", type: "country" },
            { name: "Sierra Leone", symbol: "üá∏üá±", region: "Africa", type: "country" },
            { name: "Liberia", symbol: "üá±üá∑", region: "Africa", type: "country" },
            { name: "Mali", symbol: "üá≤üá±", region: "Africa", type: "country" },
            { name: "Burkina Faso", symbol: "üáßüá´", region: "Africa", type: "country" },
            { name: "Gwinea R√≥wnikowa", symbol: "üá¨üá∂", region: "Africa", type: "country" },
            { name: "Namibia", symbol: "üá≥üá¶", region: "Africa", type: "country" },
            { name: "Botswana", symbol: "üáßüáº", region: "Africa", type: "country" },
            { name: "Lesotho", symbol: "üá±üá∏", region: "Africa", type: "country" },
            { name: "Eswatini", symbol: "üá∏üáø", region: "Africa", type: "country" },
            { name: "RPA", symbol: "üáøüá¶", region: "Africa", type: "country" },
            { name: "Mozambik", symbol: "üá≤üáø", region: "Africa", type: "country" },
            { name: "Zimbabwe", symbol: "üáøüáº", region: "Africa", type: "country" },
            { name: "Zambia", symbol: "üáøüá≤", region: "Africa", type: "country" },
            { name: "Malawi", symbol: "üá≤üáº", region: "Africa", type: "country" },
            { name: "Madagaskar", symbol: "üá≤üá¨", region: "Africa", type: "country" },
            { name: "Mauritius", symbol: "üá≤üá∫", region: "Africa", type: "country" },
            { name: "Seszele", symbol: "üá∏üá®", region: "Africa", type: "country" },
            { name: "Komory", symbol: "üá∞üá≤", region: "Africa", type: "country" },
            { name: "B√©nin", symbol: "üáßüáØ", region: "Africa", type: "country" },
            { name: "Togo", symbol: "üáπüá¨", region: "Africa", type: "country" },
            { name: "Ghana", symbol: "üá¨üá≠", region: "Africa", type: "country" },
            { name: "Wybrze≈ºe Ko≈õci S≈Çoniowej", symbol: "üá®üáÆ", region: "Africa", type: "country" },
            { name: "Angolia", symbol: "üá¶üá¥", region: "Africa", type: "country" },
            { name: "Niger", symbol: "üá≥üá™", region: "Africa", type: "country" },
            { name: "Nigeria", symbol: "üá≥üá¨", region: "Africa", type: "country" },
            // AMERYKA P√ì≈ÅNOCNA
            { name: "Stany Zjednoczone", symbol: "üá∫üá∏", region: "Americas", type: "country" },
            { name: "Kanada", symbol: "üá®üá¶", region: "Americas", type: "country" },
            { name: "Meksyk", symbol: "üá≤üáΩ", region: "Americas", type: "country" },
            { name: "Gwatemala", symbol: "üá¨üáπ", region: "Americas", type: "country" },
            { name: "Belize", symbol: "üáßüáø", region: "Americas", type: "country" },
            { name: "Honduras", symbol: "üá≠üá≥", region: "Americas", type: "country" },
            { name: "El Salvador", symbol: "üá∏üáª", region: "Americas", type: "country" },
            { name: "Nikaragua", symbol: "üá≥üáÆ", region: "Americas", type: "country" },
            { name: "Kostaryka", symbol: "üá®üá∑", region: "Americas", type: "country" },
            { name: "Panama", symbol: "üáµüá¶", region: "Americas", type: "country" },
            { name: "Kuba", symbol: "üá®üá∫", region: "Americas", type: "country" },
            { name: "Dominikana", symbol: "üá©üá¥", region: "Americas", type: "country" },
            { name: "Haiti", symbol: "üá≠üáπ", region: "Americas", type: "country" },
            { name: "Jamajka", symbol: "üáØüá≤", region: "Americas", type: "country" },
            { name: "Bahamy", symbol: "üáßüá∏", region: "Americas", type: "country" },
            { name: "Trynidad i Tobago", symbol: "üáπüáπ", region: "Americas", type: "country" },
            { name: "Barbados", symbol: "üáßüáß", region: "Americas", type: "country" },
            // AMERYKA PO≈ÅUDNIOWA
            { name: "Brazylia", symbol: "üáßüá∑", region: "Americas", type: "country" },
            { name: "Argentyna", symbol: "üá¶üá∑", region: "Americas", type: "country" },
            { name: "Chile", symbol: "üá®üá±", region: "Americas", type: "country" },
            { name: "Peru", symbol: "üáµüá™", region: "Americas", type: "country" },
            { name: "Kolumbia", symbol: "üá®üá¥", region: "Americas", type: "country" },
            { name: "Wenezuela", symbol: "üáªüá™", region: "Americas", type: "country" },
            { name: "Gujana", symbol: "üá¨üáæ", region: "Americas", type: "country" },
            { name: "Surinam", symbol: "üá∏üá∑", region: "Americas", type: "country" },
            { name: "Ekwador", symbol: "üá™üá®", region: "Americas", type: "country" },
            { name: "Boliwia", symbol: "üáßüá¥", region: "Americas", type: "country" },
            { name: "Urugwaj", symbol: "üá∫üáæ", region: "Americas", type: "country" },
            { name: "Paragwaj", symbol: "üáµüáæ", region: "Americas", type: "country" },
            // OCEANIA
            { name: "Australia", symbol: "üá¶üá∫", region: "Oceania", type: "country" },
            { name: "Nowa Zelandia", symbol: "üá≥üáø", region: "Oceania", type: "country" },
            { name: "Fid≈ºi", symbol: "üá´üáØ", region: "Oceania", type: "country" },
            { name: "Papua Nowa Gwinea", symbol: "üáµüá¨", region: "Oceania", type: "country" },
            { name: "Wyspy Salomona", symbol: "üá∏üáß", region: "Oceania", type: "country" },
            { name: "Vanuatu", symbol: "üáªüá∫", region: "Oceania", type: "country" },
            { name: "Samoa", symbol: "üáºüá∏", region: "Oceania", type: "country" },
            { name: "Kiribati", symbol: "üá∞üáÆ", region: "Oceania", type: "country" },
            { name: "Nauru", symbol: "üá≥üá∑", region: "Oceania", type: "country" },
            { name: "Palau", symbol: "üáµüáº", region: "Oceania", type: "country" },
            { name: "Wyspy Marshalla", symbol: "üá≤üá≠", region: "Oceania", type: "country" },
            { name: "Mikronezja", symbol: "üá´üá≤", region: "Oceania", type: "country" },
            { name: "Tonga", symbol: "üáπüá¥", region: "Oceania", type: "country" },
        ];

        const allFlagsExtended = allFlags.concat([
            // WYSPY
            { name: "Wyspy Faroe", symbol: "üá´üá¥", region: "Europe", type: "island" },
            { name: "Grenladia", symbol: "üá¨üá±", region: "Americas", type: "island" },
            { name: "Bermudy", symbol: "üáßüá≤", region: "Americas", type: "island" },
            { name: "Kajmany", symbol: "üá∞üáæ", region: "Americas", type: "island" },
            { name: "Turks i Caicos", symbol: "üáπüá®", region: "Americas", type: "island" },
            { name: "Anguilla", symbol: "üá¶üáÆ", region: "Americas", type: "island" },
            { name: "Sint Maarten", symbol: "üá∏üáΩ", region: "Americas", type: "island" },
            { name: "Cura√ßao", symbol: "üá®üáº", region: "Americas", type: "island" },
            { name: "Aruba", symbol: "üá¶üáº", region: "Americas", type: "island" },
            { name: "Porto Rico", symbol: "üáµüá∑", region: "Americas", type: "island" },
            { name: "Montserrat", symbol: "üá≤üá∏", region: "Americas", type: "island" },
            { name: "Wyspa ≈öwiƒôtej Heleny", symbol: "üá∏üá≠", region: "Africa", type: "island" },
            { name: "Wyspa Bo≈ºego Narodzenia", symbol: "üá®üáΩ", region: "Oceania", type: "island" },
            { name: "Wyspy Kokosowe", symbol: "üá®üá®", region: "Oceania", type: "island" },
            { name: "P√≥lnocne Mariany", symbol: "üá≤üáµ", region: "Oceania", type: "island" },
            { name: "Guam", symbol: "üá¨üá∫", region: "Oceania", type: "island" },
            { name: "Polinezja Francuska", symbol: "üáµüá´", region: "Oceania", type: "island" },
            { name: "Tokelau", symbol: "üáπüá∞", region: "Oceania", type: "island" },
            { name: "Niue", symbol: "üá≥üá∫", region: "Oceania", type: "island" },
            { name: "Pitcairn", symbol: "üáµüá≥", region: "Oceania", type: "island" },
            { name: "Samoa Ameryka≈Ñskie", symbol: "üá¶üá∏", region: "Oceania", type: "island" },
            { name: "Wyspy Cooka", symbol: "üá®üá∞", region: "Oceania", type: "island" },
            { name: "Wallis i Futuna", symbol: "üáºüá´", region: "Oceania", type: "island" },
            { name: "Nowa Kaledonia", symbol: "üá≥üá®", region: "Oceania", type: "island" },
        ]);
        // ------------------

        let currentQuizData = []; 
        let currentPool = [];
        let currentQuestionIndex = 0;
        let score = 0;
        // ZAMIANA: zamiast dynamicznie inkrementowaƒá totalQuestions przy ka≈ºdym pytaniu,
        // ustawiamy docelowƒÖ liczbƒô pyta≈Ñ przy starcie quizu (max 10).
        let totalQuestions = 0;      // docelowa liczba pyta≈Ñ w tej sesji (np. 10)
        let answeredCount = 0;      // ile pyta≈Ñ ju≈º odpowiedziano (u≈ºywane do progresu)
        let incorrectAnswers = [];  // zbieramy obiekty { name, selected, correct }
        let lastCategory = null;
        let lastDifficulty = null;

        // Elementy DOM
        const menuContainer = document.getElementById('menu');
        const quizContent = document.getElementById('quizContent');
        const aboutContent = document.getElementById('aboutContent');
        const mainTitle = document.getElementById('mainTitle');
        const questionTextElement = document.getElementById('questionText');
        const symbolDisplayElement = document.getElementById('symbolDisplay');
        const optionsContainer = document.getElementById('options');
        const feedbackElement = document.getElementById('feedback');
        const scoreElement = document.getElementById('score');

        // --- G≈Å√ìWNA FUNKCJA ZARZƒÑDZANIA WIDOKAMI ---
        function showSection(sectionId) {
            // Ukrywa wszystkie sekcje
            menuContainer.style.display = 'none';
            quizContent.style.display = 'none';
            aboutContent.style.display = 'none';
            document.getElementById('opinionsContent').style.display = 'none';
            
            // Pokazuje tylko wybranƒÖ sekcjƒô
            if (sectionId === 'menu') {
                showMenu();
                menuContainer.style.display = 'block';
            } else if (sectionId === 'about') {
                mainTitle.textContent = "Informacje o projekcie";
                aboutContent.style.display = 'block';
            } else if (sectionId === 'opinions') {
                mainTitle.textContent = "Opinie u≈ºytkownik√≥w";
                document.getElementById('opinionsContent').style.display = 'block';
                loadOpinions();
            }
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- FUNKCJA WYSWIETLA MENU ---
        function showMenu() {
            document.getElementById('logoImage').style.display = 'block';
            menuContainer.innerHTML = '';

            // zabezpieczenie: je≈õli i18n lub obecny jƒôzyk nie istnieje, u≈ºyj warto≈õci domy≈õlnych
            const t = (window.i18n && window.i18n[currentLanguage]) ? window.i18n[currentLanguage] : { mainTitle: 'Wybierz Kategoriƒô Quizu', categoryMap: {} };
            mainTitle.textContent = t.mainTitle;

            Object.keys(allQuizData).forEach(categoryName => {
                const button = document.createElement('button');
                button.textContent = (t.categoryMap && t.categoryMap[categoryName]) ? t.categoryMap[categoryName] : categoryName;
                button.onclick = () => showDifficulty(categoryName);
                menuContainer.appendChild(button);
            });
        }

        function showDifficulty(categoryName) {
            // Bezpieczne pobranie t≈Çumacze≈Ñ (fallback gdy i18n/brak jƒôzyka)
            const t = (window.i18n && window.i18n[currentLanguage]) ? window.i18n[currentLanguage] : {};
            mainTitle.textContent = t.difficultyTitle || 'Wybierz poziom trudno≈õci';
            lastCategory = categoryName; // save internal category key
            menuContainer.innerHTML = '';
            document.getElementById('logoImage').style.display = 'none';

            // difficulty keys (internal) mapped to labels (z fallbackami)
            const keys = ['easy','medium','hard','very'];
            keys.forEach(key => {
                const btn = document.createElement('button');
                const label = (t.difficulties && t.difficulties[key]) ? t.difficulties[key]
                    : (key === 'very' ? 'Bardzo trudny' : key === 'hard' ? 'Trudny' : key === 'medium' ? '≈öredni' : '≈Åatwy');
                btn.textContent = label;
                btn.onclick = () => startQuiz(categoryName, key);
                menuContainer.appendChild(btn);
            });
        }

        function startQuiz(categoryName, difficultyKey) {
            lastCategory = categoryName;
            lastDifficulty = difficultyKey; // save internal key
             // Wyb√≥r puli pyta≈Ñ zale≈ºnie od kategorii i poziomu trudno≈õci (u≈ºywamy kluczy)
             if (categoryName === "Kraje (Flagi)") {
                 if (difficultyKey === 'very') {
                     currentPool = allFlagsExtended.filter(item => item.type === "island");
                 } else if (difficultyKey === 'hard') {
                     currentPool = allFlags.slice();
                 } else if (difficultyKey === 'medium') {
                     currentPool = allFlags.filter(f => f.region === 'Europe');
                 } else { // easy
                     currentPool = allQuizData["Kraje (Flagi)"].slice();
                 }
                 currentQuizData = currentPool.map(item => ({ name: item.name, symbol: item.symbol, type: item.type }));
             }
             shuffleArray(currentQuizData);
             currentQuestionIndex = 0;
             score = 0;
             totalQuestions = Math.min(10, currentQuizData.length);
             answeredCount = 0;
             incorrectAnswers = [];

            // Bezpieczne etykiety kategorii / poziomu (fallback gdy brak t≈Çumacze≈Ñ)
            const t = (window.i18n && window.i18n[currentLanguage]) ? window.i18n[currentLanguage] : {};
            const catLabel = (t.categoryMap && t.categoryMap[categoryName]) ? t.categoryMap[categoryName] : categoryName;
            const diffLabel = (t.difficulties && t.difficulties[difficultyKey]) ? t.difficulties[difficultyKey] : difficultyKey;
            mainTitle.textContent = `${catLabel} - Poziom: ${diffLabel}`;
             document.getElementById('logoImage').style.display = 'none';
             menuContainer.style.display = 'none';
             aboutContent.style.display = 'none';
             document.getElementById('opinionsContent').style.display = 'none';
             quizContent.style.display = 'block';
             loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                questionTextElement.textContent = i18n[currentLanguage].mainTitle; // or "Koniec Quizu!"
                symbolDisplayElement.textContent = "üéâ";
                let wrongCount = totalQuestions - score;
                let summaryHtml = `<div style="text-align:left;">
                    <p>Twoje wyniki: <strong>${score}</strong> poprawnych, <strong>${wrongCount}</strong> b≈Çƒôdnych (z ${totalQuestions}).</p>`;

                // Zbuduj pe≈ÇnƒÖ listƒô odpowiedzi u≈ºytkownika (poprawne i b≈Çƒôdne)
                let allAnswers = [];
                for (let i = 0; i < totalQuestions; i++) {
                    const q = currentQuizData[i];
                    // Szukamy czy by≈Ça b≈Çƒôdna odpowied≈∫ dla tego pytania
                    const wrong = incorrectAnswers.find(item => item.name === q.name);
                    if (wrong) {
                        allAnswers.push({
                            name: q.name,
                            selected: wrong.selected,
                            correct: q.symbol,
                            isCorrect: false
                        });
                    } else {
                        allAnswers.push({
                            name: q.name,
                            selected: q.symbol,
                            correct: q.symbol,
                            isCorrect: true
                        });
                    }
                }

                summaryHtml += `<table style="width:100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Pytanie</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Twoja odpowied≈∫</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Poprawna odpowied≈∫</th>
                            <th style="border-bottom:1px solid #ccc; text-align:left; padding:6px;">Status</th>
                        </tr>
                    </thead>
                    <tbody>`;
                allAnswers.forEach(item => {
                    summaryHtml += `<tr>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.name}</td>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.selected}</td>
                        <td style="padding:6px; border-top:1px solid #eee;">${item.correct}</td>
                        <td style="padding:6px; border-top:1px solid #eee; color:${item.isCorrect ? '#2ecc71' : '#e74c3c'};">
                            ${item.isCorrect ? '‚úîÔ∏è' : '‚ùå'}
                        </td>
                    </tr>`;
                });
                summaryHtml += `</tbody></table>`;

                summaryHtml += `<div style="margin-top:12px;">
                    <button onclick="showSection('menu')" style="margin-right:8px;">${i18n[currentLanguage].summaryBackToMenu}</button>
                    <button onclick="startQuiz('${lastCategory}', '${lastDifficulty}')">${i18n[currentLanguage].summaryTryAgain}</button>
                </div>
                </div>`;

                optionsContainer.innerHTML = summaryHtml;
                feedbackElement.textContent = "";
                scoreElement.textContent = `Wynik: ${score} / ${totalQuestions}`;
                return;
            }

            const currentQuestion = currentQuizData[currentQuestionIndex];
            questionTextElement.textContent = currentQuestion.name;
            symbolDisplayElement.textContent = "?";
            optionsContainer.innerHTML = '';
            feedbackElement.textContent = '';

            let options = [currentQuestion.symbol];
            let incorrectSymbols = [];
            const questionType = currentQuestion.type;

            currentPool.forEach(item => {
                if (item.symbol && item.symbol !== currentQuestion.symbol) {
                    if (!questionType || item.type === questionType) {
                        incorrectSymbols.push(item.symbol);
                    }
                }
            });
            shuffleArray(incorrectSymbols);
            options = options.concat(incorrectSymbols.slice(0, Math.min(3, incorrectSymbols.length)));
            shuffleArray(options);

            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkAnswer(button, option, currentQuestion.symbol, currentQuestion.name);
                optionsContainer.appendChild(button);
            });

            scoreElement.textContent = `Ilo≈õƒá: ${currentQuestionIndex + 1} / ${totalQuestions}`;
        }
        
        function checkAnswer(clickedButton, selectedSymbol, correctAnswerSymbol, questionName) {
            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
            });
            symbolDisplayElement.textContent = correctAnswerSymbol;

            if (selectedSymbol === correctAnswerSymbol) {
                feedbackElement.textContent = i18n[currentLanguage].feedback.correct;
                feedbackElement.className = "feedback correct";
                clickedButton.style.backgroundColor = "#2ecc71";
                score++;
            } else {
                feedbackElement.textContent = i18n[currentLanguage].feedback.incorrectPrefix + correctAnswerSymbol;
                feedbackElement.className = "feedback incorrect";
                clickedButton.style.backgroundColor = "#e74c3c";
                Array.from(optionsContainer.children).forEach(button => {
                    if (button.textContent === correctAnswerSymbol) {
                        button.style.backgroundColor = "#2ecc71";
                    }
                });
                incorrectAnswers.push({
                    name: questionName,
                    selected: selectedSymbol,
                    correct: correctAnswerSymbol
                });
            }

            answeredCount++;
            if (currentQuestionIndex + 1 < totalQuestions) {
                scoreElement.textContent = `Ilo≈õƒá: ${currentQuestionIndex + 2} / ${totalQuestions}`;
            }

            setTimeout(() => {
                currentQuestionIndex++;
                loadQuestion();
            }, 1200);
        }

        // --- OPINIE (ZAKTUALIZOWANE NA FIREBASE) ---

        function loadOpinions() {
            const opinionsList = document.getElementById('opinionsList');
            
            if (!db) {
                // Fallback na localStorage
                const opinions = JSON.parse(localStorage.getItem('quizOpinions')) || [];
                displayOpinions(opinions, opinionsList);
                return;
            }

            // ≈Åadowanie z Firebase
            opinionsList.innerHTML = `<p style="text-align: center; color: #bdc3c7;">${i18n[currentLanguage].loadingOpinions}</p>`;
            
            const opinionsRef = firebase.database().ref('opinions');
            opinionsRef.orderByChild('timestamp').limitToLast(50).once('value', (snapshot) => {
                const data = snapshot.val();
                const opinions = data ? Object.values(data) : [];
                displayOpinions(opinions.reverse(), opinionsList);
            }).catch(error => {
                console.error("Firebase error:", error);
                opinionsList.innerHTML = `<p style="text-align: center; color: #e74c3c;">B≈ÇƒÖd ≈Çadowania opinii</p>`;
            });
        }

        function displayOpinions(opinions, opinionsList) {
            if (opinions.length === 0) {
                opinionsList.innerHTML = `<p style="text-align: center; color: #bdc3c7;">${i18n[currentLanguage].noOpinions}</p>`;
                return;
            }
            opinionsList.innerHTML = '';
            opinions.forEach((opinion) => {
                const opinionDiv = document.createElement('div');
                opinionDiv.style.cssText = 'background-color: rgba(100, 100, 100, 0.2); padding: 12px; margin: 10px 0; border-radius: 6px; border-left: 3px solid #f1c40f;';
                const dateStr = opinion.date || 'Niedawno';
                opinionDiv.innerHTML = `
                    <p style="margin: 0 0 5px 0; font-weight: bold; color: #f1c40f;">${opinion.author || 'Anonimowy'}</p>
                    <p style="margin: 0; color: #ecf0f1;">${opinion.text}</p>
                    <small style="color: #bdc3c7;">${dateStr}</small>
                `;
                opinionsList.appendChild(opinionDiv);
            });
        }

        function addOpinion() {
            const author = document.getElementById('opinionAuthor').value.trim();
            const text = document.getElementById('opinionText').value.trim();

            if (text === '') {
                alert(i18n[currentLanguage].alertEmptyOpinion);
                return;
            }

            const now = new Date();
            const dateStr = now.toLocaleDateString((currentLanguage==='pl')?'pl-PL':'en-GB') + ' ' + now.toLocaleTimeString((currentLanguage==='pl')?'pl-PL':'en-GB', { hour: '2-digit', minute: '2-digit' });

            if (!db) {
                // Fallback na localStorage
                const opinions = JSON.parse(localStorage.getItem('quizOpinions')) || [];
                opinions.push({
                    author: author || (currentLanguage==='pl' ? 'Anonimowy' : 'Anonymous'),
                    text: text,
                    date: dateStr
                });
                localStorage.setItem('quizOpinions', JSON.stringify(opinions));
                loadOpinions();
                alert(i18n[currentLanguage].alertThankYou);
                return;
            }

            // Zapis do Firebase
            const opinionsRef = firebase.database().ref('opinions').push();
            opinionsRef.set({
                author: author || (currentLanguage==='pl' ? 'Anonimowy' : 'Anonymous'),
                text: text,
                date: dateStr,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById('opinionAuthor').value = '';
                document.getElementById('opinionText').value = '';
                loadOpinions();
                alert(i18n[currentLanguage].alertThankYou);
            }).catch(error => {
                console.error("Error:", error);
                alert(i18n[currentLanguage].alertOpinionError);
            });
        }

        // Toggle dropdown
        document.getElementById('langBtn').addEventListener('click', () => {
            const dd = document.getElementById('langDropdown');
            dd.style.display = dd.style.display === 'block' ? 'none' : 'block';
        });
        // Close dropdown on outside click
        window.addEventListener('click', (e) => {
            const ls = document.getElementById('langSelector');
            if (!ls.contains(e.target)) {
                document.getElementById('langDropdown').style.display = 'none';
            }
        });

        let currentLanguage = 'pl';

        function setLanguage(lang) {
             currentLanguage = lang;
             const t = (window.i18n && window.i18n[lang]) ? window.i18n[lang] : {};
 
             // Update nav buttons (safeguard przy braku t≈Çumacze≈Ñ)
             document.getElementById('navStart').textContent = (t.nav && t.nav.start) ? t.nav.start : 'START';
             document.getElementById('navAbout').textContent = (t.nav && t.nav.about) ? t.nav.about : 'O PROJEKCIE';
             document.getElementById('navOpinions').textContent = (t.nav && t.nav.opinions) ? t.nav.opinions : 'OPINIE';
             document.getElementById('langBtn').textContent = (lang === 'pl') ? 'PL ‚ñæ' : 'EN ‚ñæ';
 
             // Update mainTitle if on menu
             if (document.getElementById('menu').style.display !== 'none') {
                 document.getElementById('mainTitle').textContent = t.mainTitle || 'Wybierz Kategoriƒô Quizu';
             }
 
             // Update static content: about (fallback je≈ºeli brak tre≈õci)
             document.getElementById('aboutContent').innerHTML = t.aboutHTML || '<p style="color:#bdc3c7;">Brak tre≈õci do wy≈õwietlenia</p>';
 
             // opinionsContent: build form + opinionsList container (safeguard z fallbackami)
             const of = t.opinionsForm || {};
             document.getElementById('opinionsContent').innerHTML = `
                 <h2>${of.header || 'Podziel siƒô opiniƒÖ'}</h2>
                 <div style="background-color: rgba(100, 100, 100, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                     <h3>${of.shareHeading || 'Napisz opiniƒô'}</h3>
                     <input type="text" id="opinionAuthor" placeholder="${of.authorPlaceholder || 'Autor (opcjonalnie)'}" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 4px; box-sizing: border-box;">
                     <textarea id="opinionText" placeholder="${of.textPlaceholder || 'Twoja opinia...'}" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 4px; box-sizing: border-box; min-height: 80px; font-family: Arial, sans-serif;"></textarea>
                     <button onclick="addOpinion()" style="width: 100%; padding: 10px; background-color: #f1c40f; color: #2c3e50; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 16px;">${of.sendButton || 'Wy≈õlij'}</button>
                 </div>
                 <div id="opinionsList" style="max-height: 400px; overflow-y: auto;"></div>
             `;
 
             // Update question prompt
             const qp = document.getElementById('questionPrompt');
             if (qp) qp.textContent = t.questionPrompt || 'Jaki symbol reprezentuje:';
 
            // Rebuild widoczne menu / wyb√≥r poziomu w nowym jƒôzyku
            if (document.getElementById('menu').style.display !== 'none') {
                if (lastCategory) {
                    // jeste≈õmy w widoku wyboru poziomu - odtw√≥rz go w nowym jƒôzyku
                    showDifficulty(lastCategory);
                } else {
                    // jeste≈õmy w g≈Ç√≥wnym menu kategorii - odtw√≥rz etykiety
                    showMenu();
                }
            }
         }
 
        // Uruchomienie menu przy ≈Çadowaniu strony i ustawienie domy≈õlnego jƒôzyka
        window.onload = () => {
            // najpierw ustaw jƒôzyk (t≈Çumaczenia), potem poka≈º menu ‚Äî zapobiega "pustym" etykietom
            setLanguage('pl');
            showSection('menu');
        };
    </script>

</body>
</html>
